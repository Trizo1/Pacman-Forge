(()=>{"use strict";const e=20,t="blank",n="wall",o="dot",i="pacman",s=[t,n,"dyn-wall","spawn-wall",o,i,"ghost"],r=[{grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,1,1,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,1,1,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,1,4,4,4,4,4,4,4,4,4,4,4,4,1,1,4,4,4,4,4,4,4,4,4,4,4,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,1,0,0,0],[0,0,0,1,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,1,0,0,0],[0,0,0,0,0,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,1,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,1,1,1,1,1,4,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,1,1,1,1,1,4,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,1,1,4,1,1,0,1,1,1,1,1,1,1,1,0,1,1,4,1,1,4,1,0,0,0,0,0],[1,1,1,1,1,1,4,1,1,4,1,1,0,1,0,0,0,0,0,0,1,0,1,1,4,1,1,4,1,1,1,1,1,1],[4,4,4,5,4,4,4,1,1,4,1,1,0,1,1,0,0,0,0,1,1,0,1,1,4,1,1,4,4,4,4,4,4,4],[1,1,1,1,1,1,1,1,1,4,1,1,0,1,0,0,0,0,0,0,1,0,1,1,4,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,4,1,1,0,1,1,1,0,0,1,1,1,0,1,1,4,1,1,1,1,1,1,1,1,1],[4,4,4,4,4,4,4,1,1,4,1,1,0,0,0,0,0,0,0,0,0,0,1,1,4,1,1,4,4,4,4,4,4,4],[1,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,1],[0,0,0,0,0,1,4,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,0,0,0,0,0],[0,0,0,0,0,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,4,1,1,4,1,1,4,1,0,0,0,0,0],[0,0,0,1,1,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,4,1,1,4,1,1,4,1,1,1,0,0,0],[0,0,0,1,4,4,4,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,4,4,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,1,1,1,4,1,1,4,1,1,1,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,4,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,1,1,4,4,4,4,4,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,4,1,1,1,1,1,1,1,1,4,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,1,1,1,1,4,1,1,4,1,1,1,1,1,1,1,1,4,1,1,4,1,1,1,1,4,1,0,0,0],[0,0,0,1,4,4,4,4,4,4,4,4,4,4,4,4,1,1,4,4,4,4,4,4,4,4,4,4,4,4,1,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,1,1,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],offsetX:0,offsetY:0,offsetZ:340,rotationX:0,rotationY:0,rotationZ:0,color:"#c2b853"},{grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,0,0,0,0,0,0,1,1,0,1,1,0,1,1,0,0,0,0,0,0,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,0,1,1,0,0,0,0,1,1,0,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,1,1,0,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,0,1,1,1,0,0,0],[0,0,0,0,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,0,0,0,0,0,0,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,0,0,0,0,0],[0,0,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,0,1,0,1,0,0,0],[0,0,0,1,0,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,1,1,0,1,0,1,0,0,0],[0,0,0,1,0,1,0,0,0,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,0,0,0,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0]],offsetX:340,offsetY:0,offsetZ:0,rotationX:0,rotationY:Math.PI/2,rotationZ:0,color:"#5036d9"},{grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,1,1,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,0,0,0],[0,0,0,1,1,1,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,0,1,0,0,0],[0,0,0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,0,0,0],[0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,1,1,0,1,0,0,0,0,0,0,1,0,1,1,0,0,0,0,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0]],offsetX:-360,offsetY:0,offsetZ:0,rotationX:0,rotationY:Math.PI/2,rotationZ:0,color:"#359c9c"}];let l={iCell:0,jCell:0,movement:{x:0,y:0},moveDirection:null,moveInterval:null,reqMove:null,posToMove:null,material:new THREE.MeshLambertMaterial({color:"#FF1FF8"}),radius:12,animationTime:120,mesh:null};const a="down",h="left",u="right";function c(e,n,i){if(l.iCell-n>=0&&l.iCell-n<=33&&l.jCell+e>=0&&l.jCell+e<=33)return s[i[l.iCell-n][l.jCell+e]]==t||s[i[l.iCell-n][l.jCell+e]]==o}function f(){clearInterval(l.moveInterval),cancelAnimationFrame(l.reqMove),l.moveInterval=null,l.reqMove=null,l.movement={x:0,y:0},l.moveDirection=null,l.posToMove=null}const p=Object.freeze({_CSGDEBUG:!1,defaultResolution2D:32,defaultResolution3D:12,EPS:1e-5,angleEPS:.1,areaEPS:49916708323414084e-28,all:0,top:1,bottom:2,left:3,right:4,front:5,back:6}),d=function(e){return!isNaN(e)||e===1/0||e===-1/0},g=function(e,t){this.normal=e,this.w=t};g.fromVector3Ds=function(e,t,n){let o=t.minus(e).cross(n.minus(e)).unit();return new g(o,o.dot(e))},g.prototype={flipped:function(){return new g(this.normal.negated(),-this.w)},getTag:function(){let e=this.tag;return e||(e=window.getTag(),this.tag=e),e},equals:function(e){return this.normal.equals(e.normal)&&this.w===e.w},splitLineBetweenPoints:function(e,t){let n=t.minus(e),o=(this.w-this.normal.dot(e))/this.normal.dot(n);return isNaN(o)&&(o=0),o>1&&(o=1),o<0&&(o=0),e.plus(n.times(o))},signedDistanceToPoint:function(e){return this.normal.dot(e)-this.w},mirrorPoint:function(e){let t=this.signedDistanceToPoint(e);return e.minus(this.normal.times(2*t))}};let m=function(e,t,n){if(this.vertices=e,this.shared={color:t?t.color:null,getHash:function(){return this.color?this.color.join("/"):this.color},getTag:function(){let e=this.tag;return e||(e=getTag(),this.tag=e),e}},this.plane=arguments.length>=3?n:g.fromVector3Ds(e[0].pos,e[1].pos,e[2].pos),p._CSGDEBUG&&!this.checkIfConvex())throw new Error("Not convex!")};m.prototype={boundingSphere:function(){if(!this.cachedBoundingSphere){let e=this.boundingBox(),t=e[0].plus(e[1]).times(.5),n=e[1].minus(t).length();this.cachedBoundingSphere=[t,n]}return this.cachedBoundingSphere},boundingBox:function(){if(!this.cachedBoundingBox){let e,t,n=this.vertices,o=n.length;e=0===o?new y(0,0,0):n[0].pos,t=e;for(let i=1;i<o;i++){let o=n[i].pos;e=e.min(o),t=t.max(o)}this.cachedBoundingBox=[e,t]}return this.cachedBoundingBox},flipped:function(){let e=this.vertices.map((function(e){return e.flipped()}));return e.reverse(),new m(e,this.shared)}};const y=function(e,t,n){if(3===arguments.length)this._x=parseFloat(e),this._y=parseFloat(t),this._z=parseFloat(n);else if(2===arguments.length)this._x=parseFloat(e),this._y=parseFloat(t),this._z=0;else{var o=!0;if(1===arguments.length)if("object"==typeof e)e instanceof y?(this._x=e._x,this._y=e._y,this._z=e._z):e instanceof Array?e.length<2||e.length>3?o=!1:(this._x=parseFloat(e[0]),this._y=parseFloat(e[1]),3===e.length?this._z=parseFloat(e[2]):this._z=0):"x"in e&&"y"in e?(this._x=parseFloat(e.x),this._y=parseFloat(e.y),this._z="z"in e?parseFloat(e.z):0):"_x"in e&&"_y"in e?(this._x=parseFloat(e._x),this._y=parseFloat(e._y),this._z="_z"in e?parseFloat(e._z):0):o=!1;else{var i=parseFloat(e);this._x=i,this._y=i,this._z=i}else o=!1;if(!o)throw new Error("wrong arguments");d(this._x)&&d(this._y)&&d(this._z)||(o=!1)}};y.Create=function(e,t,n){var o=Object.create(y.prototype);return o._x=e,o._y=t,o._z=n,o},y.prototype={get x(){return this._x},get y(){return this._y},get z(){return this._z},set x(e){throw new Error("Vector is immutable")},set y(e){throw new Error("Vector is immutable")},set z(e){throw new Error("Vector is immutable")},clone:function(){return y.Create(this._x,this._y,this._z)},negated:function(){return y.Create(-this._x,-this._y,-this._z)},abs:function(){return y.Create(Math.abs(this._x),Math.abs(this._y),Math.abs(this._z))},plus:function(e){return y.Create(this._x+e._x,this._y+e._y,this._z+e._z)},minus:function(e){return y.Create(this._x-e._x,this._y-e._y,this._z-e._z)},times:function(e){return y.Create(this._x*e,this._y*e,this._z*e)},dividedBy:function(e){return y.Create(this._x/e,this._y/e,this._z/e)},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z},lerp:function(e,t){return this.plus(e.minus(this).times(t))},lengthSquared:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSquared())},unit:function(){return this.dividedBy(this.length())},cross:function(e){return y.Create(this._y*e._z-this._z*e._y,this._z*e._x-this._x*e._z,this._x*e._y-this._y*e._x)},distanceTo:function(e){return this.minus(e).length()},distanceToSquared:function(e){return this.minus(e).lengthSquared()},equals:function(e){return this._x===e._x&&this._y===e._y&&this._z===e._z},multiply4x4:function(e){return e.leftMultiply1x3Vector(this)},randomNonParallelVector:function(){var e=this.abs();return e._x<=e._y&&e._x<=e._z?y.Create(1,0,0):e._y<=e._x&&e._y<=e._z?y.Create(0,1,0):y.Create(0,0,1)},min:function(e){return y.Create(Math.min(this._x,e._x),Math.min(this._y,e._y),Math.min(this._z,e._z))},max:function(e){return y.Create(Math.max(this._x,e._x),Math.max(this._y,e._y),Math.max(this._z,e._z))}};const _=function(e){this.pos=e};_.fromObject=function(e){var t=new y(e.pos);return new _(t)},_.prototype={flipped:function(){return this},getTag:function(){var e=this.tag;return e||(e=window.getTag(),this.tag=e),e},interpolate:function(e,t){var n=this.pos.lerp(e.pos,t);return new _(n)}};let v=function(){this.polygons=[],this.properties=new w};v.prototype={union:function(e){let t,n;for(e instanceof Array?(t=e.slice(0),t.push(this)):t=[this,e],n=1;n<t.length;n+=2)t.push(t[n-1].unionSub(t[n]));return t[n-1]},unionSub:function(e){if(this.mayOverlap(e)){let t=new x(this.polygons),n=new x(e.polygons);t.clipTo(n,!1),n.clipTo(t),n.invert(),n.clipTo(t),n.invert();let o=t.allPolygons().concat(n.allPolygons()),i=this.fromPolygons(o);return i.properties=this.properties._merge(e.properties),i}{let t=this.polygons.concat(e.polygons),n=this.fromPolygons(t);return n.properties=this.properties._merge(e.properties),n}},subtract:function(e){let t;t=e instanceof Array?e:[e];let n=this;for(let e=0;e<t.length;e++){let o=e===t.length-1;n=n.subtractSub(t[e],o,o)}return n},subtractSub:function(e){let t=new x(this.polygons),n=new x(e.polygons);t.invert(),t.clipTo(n),n.clipTo(t,!0),t.addPolygons(n.allPolygons()),t.invert();let o=this.fromPolygons(t.allPolygons());return o.properties=this.properties._merge(e.properties),o},intersect:function(e){let t;t=e instanceof Array?e:[e];let n=this;for(let e=0;e<t.length;e++){let o=e===t.length-1;n=n.intersectSub(t[e],o,o)}return n},intersectSub:function(e){let t=new x(this.polygons),n=new x(e.polygons);t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.addPolygons(n.allPolygons()),t.invert();let o=this.fromPolygons(t.allPolygons());return o.properties=this.properties._merge(e.properties),o},fromPolygons:function(e){let t=new v;return t.polygons=e,t},bounds:function(e=this){if(!e.cachedBoundingBox){let t=new y(0,0,0),n=new y(0,0,0),o=e.polygons,i=o.length;for(let e=0;e<i;e++){let i=o[e].boundingBox();0===e?(t=i[0],n=i[1]):(t=t.min(i[0]),n=n.max(i[1]))}e.cachedBoundingBox=[t,n]}return e.cachedBoundingBox},getBounds:function(){return this.bounds()},mayOverlap:function(e){if(0===this.polygons.length||0===e.polygons.length)return!1;{let t=this.bounds(),n=this.bounds(e);return!(t[1].x<n[0].x||t[0].x>n[1].x||t[1].y<n[0].y||t[0].y>n[1].y||t[1].z<n[0].z||t[0].z>n[1].z)}},setColor:function(e){this.polygons.forEach((t=>{t.shared.color=e}))}};const w=function(){};w.prototype={_transform:function(e){let t=new w;return w.transformObj(this,t,e),t},_merge:function(e){let t=new w;return w.cloneObj(this,t),w.addFrom(t,e),t}},w.transformObj=function(e,t,n){for(let o in e){if("_transform"===o)continue;if("_merge"===o)continue;let i=e[o],s=i;"object"==typeof i&&("transform"in i&&"function"==typeof i.transform?s=i.transform(n):i instanceof Array?(s=[],w.transformObj(i,s,n)):i instanceof w&&(s=new w,w.transformObj(i,s,n))),t[o]=s}},w.cloneObj=function(e,t){for(let n in e){if("_transform"===n)continue;if("_merge"===n)continue;let o=e[n],i=o;if("object"==typeof o)if(o instanceof Array){i=[];for(let e=0;e<o.length;e++)i.push(o[e])}else o instanceof w&&(i=new w,w.cloneObj(o,i));t[n]=i}},w.addFrom=function(e,t){for(let n in t)"_transform"!==n&&"_merge"!==n&&(n in e&&"object"==typeof e[n]&&e[n]instanceof w&&"object"==typeof t[n]&&t[n]instanceof w?w.addFrom(e[n],t[n]):n in e||(e[n]=t[n]))};const E=function(){this.parent=null,this.children=[],this.polygon=null,this.removed=!1};E.prototype={addPolygons:function(e){if(!this.isRootNode())throw new Error("Assertion failed");let t=this;e.map((function(e){t.addChild(e)}))},remove:function(){if(!this.removed){if(this.removed=!0,p._CSGDEBUG){if(this.isRootNode())throw new Error("Assertion failed");if(this.children.length)throw new Error("Assertion failed")}let e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon()}},isRemoved:function(){return this.removed},isRootNode:function(){return!this.parent},invert:function(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()},getPolygon:function(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon},getPolygons:function(e){let t,n,o,i,s=[this],r=[s];for(t=0;t<r.length;++t)for(s=r[t],n=0,o=s.length;n<o;n++)i=s[n],i.polygon?e.push(i.polygon):r.push(i.children)},splitByPlane:function(e,t,n,o,i){if(this.children.length){let s,r,l,a,h,u=[this.children];for(s=0;s<u.length;s++)for(h=u[s],r=0,l=h.length;r<l;r++)a=h[r],a.children.length?u.push(a.children):a._splitByPlane(e,t,n,o,i)}else this._splitByPlane(e,t,n,o,i)},_splitByPlane:function(e,t,n,o,i){let s=this.polygon;if(s){let r=s.boundingSphere(),l=r[1]+p.EPS,a=e.normal,h=r[0],u=a.dot(h)-e.w;if(u>l)o.push(this);else if(u<-l)i.push(this);else{let r=function(e,t){let n={type:null,front:null,back:null},o=e.normal,i=t.vertices,s=i.length;if(t.plane.equals(e))n.type=0;else{let r=e.w,l=!1,a=!1,h=[],u=-p.EPS;for(let e=0;e<s;e++){let t=o.dot(i[e].pos)-r,n=t<0;h.push(n),t>p.EPS&&(l=!0),t<u&&(a=!0)}if(l||a)if(a)if(l){n.type=4;let o=[],r=[],l=h[0];for(let t=0;t<s;t++){let n=i[t],a=t+1;a>=s&&(a=0);let u=h[a];if(l===u)l?r.push(n):o.push(n);else{let t=n.pos,s=i[a].pos,h=e.splitLineBetweenPoints(t,s),u=new _(h);l?(r.push(n),r.push(u),o.push(u)):(o.push(n),o.push(u),r.push(u))}l=u}let a=p.EPS*p.EPS;if(r.length>=3){let e=r[r.length-1];for(let t=0;t<r.length;t++){let n=r[t];n.pos.distanceToSquared(e.pos)<a&&(r.splice(t,1),t--),e=n}}if(o.length>=3){let e=o[o.length-1];for(let t=0;t<o.length;t++){let n=o[t];n.pos.distanceToSquared(e.pos)<a&&(o.splice(t,1),t--),e=n}}o.length>=3&&(n.front=new m(o,t.shared,t.plane)),r.length>=3&&(n.back=new m(r,t.shared,t.plane))}else n.type=3;else n.type=2;else{let e=o.dot(t.plane.normal);n.type=e>=0?0:1}}return n}(e,s);switch(r.type){case 0:t.push(this);break;case 1:n.push(this);break;case 2:o.push(this);break;case 3:i.push(this);break;case 4:if(r.front){let e=this.addChild(r.front);o.push(e)}if(r.back){let e=this.addChild(r.back);i.push(e)}}}}},addChild:function(e){let t=new E;return t.parent=this,t.polygon=e,this.children.push(t),t},invertSub:function(){let e,t,n,o,i=[this],s=[i];for(e=0;e<s.length;e++)for(i=s[e],t=0,n=i.length;t<n;t++)o=i[t],o.polygon&&(o.polygon=o.polygon.flipped()),s.push(o.children)},recursivelyInvalidatePolygon:function(){let e=this;for(;e.polygon;)e.polygon=null,e.parent&&(e=e.parent)}};const x=function(e){this.polygonTree=new E,this.rootnode=new b(null),e&&this.addPolygons(e)};x.prototype={invert:function(){this.polygonTree.invert(),this.rootnode.invert()},clipTo:function(e,t){t=!!t,this.rootnode.clipTo(e,t)},allPolygons:function(){let e=[];return this.polygonTree.getPolygons(e),e},addPolygons:function(e){let t=this,n=e.map((function(e){return t.polygonTree.addChild(e)}));this.rootnode.addPolygonTreeNodes(n)}};const b=function(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e};b.prototype={invert:function(){let e,t=[this];for(let n=0;n<t.length;n++){e=t[n],e.plane&&(e.plane=e.plane.flipped()),e.front&&t.push(e.front),e.back&&t.push(e.back);let o=e.front;e.front=e.back,e.back=o}},clipPolygons:function(e,t){let n,o={node:this,polygontreenodes:e},i=[];do{if(n=o.node,e=o.polygontreenodes,n.plane){let o=[],s=[],r=t?o:s,l=n.plane,a=e.length;for(let t=0;t<a;t++){let n=e[t];n.isRemoved()||n.splitByPlane(l,r,o,s,o)}n.front&&s.length>0&&i.push({node:n.front,polygontreenodes:s});let h=o.length;if(n.back&&h>0)i.push({node:n.back,polygontreenodes:o});else for(let e=0;e<h;e++)o[e].remove()}o=i.pop()}while(void 0!==o)},clipTo:function(e,t){let n=this,o=[];do{n.polygontreenodes.length>0&&e.rootnode.clipPolygons(n.polygontreenodes,t),n.front&&o.push(n.front),n.back&&o.push(n.back),n=o.pop()}while(void 0!==n)},addPolygonTreeNodes:function(e){let t,n={node:this,polygontreenodes:e},o=[];do{if(t=n.node,0===(e=n.polygontreenodes).length){n=o.pop();continue}let i=t;if(!t.plane){let n=e[0].getPolygon().plane;t.plane=n}let s=[],r=[];for(let t=0,n=e.length;t<n;++t)e[t].splitByPlane(i.plane,i.polygontreenodes,r,s,r);s.length>0&&(t.front||(t.front=new b(t)),o.push({node:t.front,polygontreenodes:s})),r.length>0&&(t.back||(t.back=new b(t)),o.push({node:t.back,polygontreenodes:r})),n=o.pop()}while(void 0!==n)}};const T=(e,t,n=[])=>(t=((e,t)=>e.map(((e,n)=>{const o=(e=>{if(e instanceof v)return e;const t=new v,n=e.index?e.index.array:[],o=e.attributes.position.array,i=(e,t=0)=>o[3*n[e]+t],s=e=>new _(new y(i(e),i(e,1),i(e,2))),r=e=>new _(new y(o[e],o[e+1],o[e+2])),l=e=>[s(e),s(e+1),s(e+2)];if(n.length)for(let e=0;e<n.length;e+=3)t.polygons.push(new m(l(e)));else for(let e=0;e<o.length;e+=9)t.polygons.push(new m([r(e),r(e+3),r(e+6)]));return t.isCanonicalized=!1,t.isRetesselated=!1,t})(e);return t[n]&&o.setColor([t[n].r,t[n].g,t[n].b,1]),o})))(t,n)).shift()[e](t);window.staticTag=1,window.getTag=()=>window.staticTag++;const C={BufferGeometry:e=>{if(!(e instanceof v))return e;const t=new THREE.BufferGeometry,n=[],o=[];let i,s=!1;return e.polygons.forEach((e=>{e.shared.color?(i=[e.shared.color[0],e.shared.color[1],e.shared.color[2]],s=!0):i=[1,1,1];for(let t=0;t<e.vertices.length-2;t++){[0,t+1,t+2].forEach((t=>{["x","y","z"].forEach((o=>{n.push(e.vertices[t].pos[o])}))}));for(let e=0;e<3;e++)o.push(...i)}})),t.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),s&&t.setAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),t.computeVertexNormals(),t},union:T.bind(void 0,"union"),subtract:T.bind(void 0,"subtract"),intersect:T.bind(void 0,"intersect")};window.CSG=C;const P=C;let M,z=r[0],R=[],k=null;const B=new THREE.MeshLambertMaterial({color:"#FFFFFF"});let j,S=[],F=0;function N(){V(),f(),k=null,R.forEach((e=>{NOP_VIEWER.overlays.removeMesh(e.mesh,"custom-scene")})),NOP_VIEWER.impl.sceneUpdated(!0,!1),R=[],A(),l.mesh.position.set(z.offsetX+l.jCell*e-330,z.offsetY-l.iCell*e+330,z.offsetZ+l.radius),O(),NOP_VIEWER.impl.sceneUpdated(!0,!1)}function V(){for(let e=0;e<34;e++)S[e]=[],z.grid[e].forEach((t=>{S[e].push(t)}))}function O(){D(o,z.grid).forEach((t=>{!function(t,n){let o;M=new THREE.SphereGeometry(5,32,32),o=new THREE.Mesh(M,B),o.position.set(z.offsetX+n*e-330,z.offsetY-t*e+330,z.offsetZ+e-8),o.name=`dot_${R.length}`,R.push({i:t,j:n,mesh:o}),NOP_VIEWER.overlays.addMesh(o,"custom-scene")}(t.i,t.j)}))}function A(){let e=D(i,z.grid)[0];l.iCell=e.i,l.jCell=e.j}function D(e,t){let n=[];for(let o=0;o<34;o++)for(let i=0;i<34;i++)s[t[o][i]]==e&&n.push({i:o,j:i});return n}function I(e){let t=[];!function(e){for(let t=0;t<34;t++)e[t]=[]}(t);const o=new THREE.MeshLambertMaterial({color:e.color});let i=[];D(n,e.grid).forEach((n=>{if(e.grid[n.i][n.j]!=t[n.i][n.j]){t[n.i][n.j]=2,L(i,n.i,n.j),Z(e.grid,"left",n.i,n.j,i,t),Z(e.grid,"right",n.i,n.j,i,t);let s=function(e){let t=[];for(let n=0;n<e.length;n++){let o=0,i=e[n];(X(e,i.x,i.y+12)||X(e,i.x,i.y+8))&&o++,(X(e,i.x,i.y-12)||X(e,i.x,i.y-8))&&o++,(X(e,i.x+12,i.y)||X(e,i.x+8,i.y))&&o++,(X(e,i.x-12,i.y)||X(e,i.x-8,i.y))&&o++,(X(e,i.x-12,i.y+12)||X(e,i.x+12,i.y+12)||X(e,i.x+12,i.y-12)||X(e,i.x-12,i.y-12))&&o++,o<5&&t.push(e[n])}return t}(i);i=[];let r=function(e){let t=e[0],n=new THREE.Shape;return n.moveTo(t.x,t.y),W(t,e,n),n}(s),l={steps:1,amount:20,bevelEnabled:!1};M=new THREE.ExtrudeGeometry(r,l);const a=new THREE.Mesh(M,o);a.position.set(e.offsetX,e.offsetY,e.offsetZ),a.rotation.setFromVector3(new THREE.Vector3(e.rotationX,e.rotationY,e.rotationZ)),NOP_VIEWER.overlays.addMesh(a,"custom-scene")}}))}function H(e){switch(e.keyCode){case 65:c(-1,0,z.grid)&&l.moveDirection!=h&&(l.moveInterval&&l.reqMove&&f(),l.moveDirection=h,G(-1,0));break;case 68:c(1,0,z.grid)&&l.moveDirection!=u&&(l.moveInterval&&l.reqMove&&f(),l.moveDirection=u,G(1,0));break;case 87:c(0,1,z.grid)&&"up"!=l.moveDirection&&(l.moveInterval&&l.reqMove&&f(),l.moveDirection="up",G(0,1));break;case 83:c(0,-1,z.grid)&&l.moveDirection!=a&&(l.moveInterval&&l.reqMove&&f(),l.moveDirection=a,G(0,-1))}}function G(t,n){l.moveInterval=setInterval((()=>{var i,r,a,h,u,p;c(t,n,S)?(function(t,n){l.movement.y=n,l.movement.x=t,l.posToMove=l.mesh.position.clone(),l.posToMove=new THREE.Vector3(l.posToMove.x+t*e,l.posToMove.y+n*e,l.posToMove.z)}(t,n),s[S[l.iCell-l.movement.y][l.jCell+l.movement.x]]==o&&(k=R.find((e=>e.i==l.iCell-l.movement.y&&e.j==l.jCell+l.movement.x)).mesh),r=l.mesh,a=l.mesh.position.clone(),h=l.posToMove,u=l.animationTime,0,p=TWEEN.Easing.Linear.None,new TWEEN.Tween(a).to(h,u).delay(0).easing(p).onUpdate((function(){r.position.copy(a),k&&(k.position.x==Math.floor(l.mesh.position.x)&&k.position.y==Math.floor(l.mesh.position.y)&&k.position.z==Math.floor(l.mesh.position.z)||k.position.x==Math.ceil(l.mesh.position.x)&&k.position.y==Math.ceil(l.mesh.position.y)&&k.position.z==Math.ceil(l.mesh.position.z))&&(F++,j.innerHTML=`Счет: ${F}`,NOP_VIEWER.overlays.removeMesh(k,"custom-scene"),k=null)})).start(),(i=S)[l.iCell][l.jCell]=0,i[l.iCell-l.movement.y][l.jCell+l.movement.x]=5,l.iCell-=l.movement.y,l.jCell+=l.movement.x):f()}),l.animationTime+20),q()}window.onload=function(){j=document.getElementById("score"),document.getElementById("newGame").onclick=N};const q=function(){l.reqMove=requestAnimationFrame(q),TWEEN.update(),NOP_VIEWER.impl.sceneUpdated(!0,!1)};function L(t,n,o){t.push({x:o*e-330-4,y:-n*e+330+4}),t.push({x:o*e-330+4,y:-n*e+330+4}),t.push({x:o*e-330+4,y:-n*e+330-4}),t.push({x:o*e-330-4,y:-n*e+330-4})}function W(e,t,n){let o=Y(e.x,e.y+12,t),i=Y(e.x,e.y+8,t),s=Y(e.x+12,e.y,t),r=Y(e.x+8,e.y,t),l=Y(e.x-12,e.y,t),a=Y(e.x-8,e.y,t),h=[s,r,Y(e.x,e.y-12,t),Y(e.x,e.y-8,t),l,a,o,i];for(let e of h)if(void 0!==e){t.splice(t.indexOf(e),1),n.lineTo(e.x,e.y),W(e,t,n);break}}function Y(e,t,n){return n.find((n=>n.x==e&&n.y==t))}function X(e,t,n){return e.some((e=>e.x==t&&e.y==n))}function Z(e,t,n,o,i,s){0!=e[n][o]&&("right"==t&&(e[n][o+1]==e[n][o]&&e[n][o+1]!=s[n][o+1]?(L(i,n,o+1),s[n][o+1]=e[n][o+1],Z(e,"right",n,o+1,i,s)):Z(e,"down",n,o,i,s)),"down"==t&&n<33&&e[n+1][o]==e[n][o]&&e[n+1][o]!=s[n+1][o]&&(L(i,n+1,o),s[n+1][o]=e[n+1][o],Z(e,"down",n+1,o,i,s),Z(e,"left",n+1,o,i,s),Z(e,"right",n+1,o,i,s)),"left"==t&&(e[n][o-1]==e[n][o]&&e[n][o-1]!=s[n][o-1]?(L(i,n,o-1),s[n][o-1]=e[n][o-1],Z(e,"left",n,o-1,i,s)):Z(e,"down",n,o,i,s)))}let U;function J(e){let t=new XMLHttpRequest;if(t.open("GET","/oauth",!1),t.send(),200!=t.status)alert(t.status+": "+t.statusText);else{let n=JSON.parse(t.responseText);e(n.access_token,n.expires_in)}}function Q(t){var n=t.getRoot().getDefaultGeometry();U.loadDocumentNode(t,n).then((t=>{console.log(U),console.log(U.getVisibleModels());let n=U.getExtension("Autodesk.ViewCubeUi");n.setViewCube("front"),n.showTriad(!0),n.setVisible(!1),U.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,(t=>{U.setQualityLevel(!0,!0),U.setGhosting(!0),U.setGroundShadow(!1),U.setGroundReflection(!1),U.setProgressiveRendering(!0),U.setCanvasClickBehavior({click:{onObject:["selectToggle"],offObject:["deselectAll"]},disableMouseMove:!0}),U.clickHandler.handleDoubleClick=e=>{},U.navigation.getCamera().zoom=1.1,U.navigation.updateCamera(),V(),NOP_VIEWER.overlays.hasScene("custom-scene")||NOP_VIEWER.overlays.addScene("custom-scene"),function(){for(let e of r)I(e)}(),function(){A();let t=new THREE.SphereGeometry(l.radius,32,32),n=new THREE.Shape;n.moveTo(0,0),n.lineTo(10,5),n.lineTo(10,-5),n.lineTo(0,0);let o=new THREE.ExtrudeGeometry(n,{steps:1,amount:30,bevelEnabled:!1});console.log(o);let i=(new THREE.BufferGeometry).fromGeometry(t),s=(new THREE.BufferGeometry).fromGeometry(o),r=P.subtract([i,s]),a=new THREE.BufferGeometry(r);console.log(a),M=new THREE.SphereGeometry(l.radius,32,32),l.material.side=THREE.DoubleSide,l.mesh=new THREE.Mesh(M,l.material),l.mesh.position.set(z.offsetX+l.jCell*e-330,z.offsetY-l.iCell*e+330,z.offsetZ+l.radius),l.mesh.name="pacman",NOP_VIEWER.overlays.addMesh(l.mesh,"custom-scene"),document.addEventListener("keydown",H)}(),O(),NOP_VIEWER.impl.sceneUpdated(!0,!1)}))}))}function $(e){console.error("onDocumentLoadFailure() - errorCode:"+e)}document.addEventListener("DOMContentLoaded",(function(){!function(){var e={env:"AutodeskProduction",getAccessToken:J};const t={extensions:["Autodesk.ViewCubeUi"]};Autodesk.Viewing.Initializer(e,(()=>{U=new Autodesk.Viewing.GuiViewer3D(document.getElementById("viewer"),t),U.start(),U.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,(function(){const e=U.model.getInstanceTree(),t=new THREE.MeshBasicMaterial({color:0});t.side=THREE.DoubleSide,U.impl.matman().addMaterial("myCustomMaterial",t,!0);const n=U.model;n.unconsolidate();const o=n.getFragmentList(),i=[0,3];for(const n of i)e.enumNodeFragments(n,(e=>{o.setMaterial(e,t)}));U.impl.invalidate(!0),U.setOptimizeNavigation(!0),U.setQualityLevel(!0,!0),U.setProgressiveRendering(!1),U.setLightPreset(6),U.setBackgroundColor(0,0,0,0,0,0)})),Autodesk.Viewing.Document.load("urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6cGFjbWFuLWZvcmdlL2N1YmVWMi5pcHQ",Q,$)}))}()}))})();